/* Spotetrack
 * spotedis + node.js
 * (c) 2014 David (daXXog) Volm ><> + + + <><
 * Released under Apache License, Version 2.0:
 * http://www.apache.org/licenses/LICENSE-2.0.html  
 */ !function(t,e){"object"==typeof exports?module.exports=e():"function"==typeof define&&define.amd?define(e):t.Spotetrack=e()}(this,function(){var t,e=require("redis"),i=require("stream").Readable,s=require("util").inherits;return t=function(t,s){this.clients=[e.createClient(6379,"127.0.0.1",{return_buffers:!0,auth_pass:null}),e.createClient(),e.createClient(),e.createClient()],this.rlist="string"==typeof t?t:"spotedis",this.uri=s,this.connect(),i.call(this)},s(t,i),t.prototype.connect=function(){var t=this;this.clients[0].on("message",function(e,i){t.push(i)}),this.clients[0].subscribe(this.uri+":data"),this.clients[1].on("message",function(e,i){i=i.split("_").map(function(t){return parseInt(t,10)}),console.log("update format",i),t.sample_rate=i[0],t.channels=i[1],t.num_frames=i[2],t.frames_size=i[3]}),this.clients[1].subscribe(this.uri+":format"),this.clients[2].on("message",function(){t.push(null),t.clients[0].quit(),t.clients[1].quit(),t.clients[2].quit()}),this.clients[2].subscribe(this.uri+":end"),this.clients[3].rpush(this.rlist,this.uri,function(){t.clients[3].quit()})},t.prototype._read=function(){},t});